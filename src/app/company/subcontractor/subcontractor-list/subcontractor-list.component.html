<div class="container mt-4">
  <div class="card">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Liste des Sous-traitants</h5>
      <button class="btn btn-light" (click)="navigateToCreate()" title="Ajouter un Sous-traitant">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive-sm">
        <table class="table table-hover table-striped mb-0">
          <thead class="bg-light">
            <tr>
              <th class="py-3 d-none d-md-table-cell">ID</th>
              <th class="py-3">Responsable</th>
              <th class="py-3">Company</th>
              <th class="py-3 d-none d-md-table-cell">Expertise</th>
              <th class="py-3 d-none d-lg-table-cell">Location</th>
              <th class="py-3 d-none d-lg-table-cell">Phone</th>
              <th class="py-3 text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contractor of subcontractors">
              <td class="align-middle d-none d-md-table-cell">{{contractor.id}}</td>
              <td class="align-middle">
                {{contractor.responsible}}
                <div class="d-block d-lg-none small text-muted">
                  {{contractor.phone}}
                </div>
              </td>
              <td class="align-middle">
                {{contractor.company}}
                <div class="d-block d-md-none small text-muted">
                  {{contractor.expertise}}
                </div>
              </td>
              <td class="align-middle d-none d-md-table-cell">{{contractor.expertise}}</td>
              <td class="align-middle d-none d-lg-table-cell">{{contractor.location}}</td>
              <td class="align-middle d-none d-lg-table-cell">{{contractor.phone}}</td>
              <td class="align-middle">
                <div class="d-flex justify-content-end gap-2">
                  <button class="btn btn-sm btn-info" (click)="openDetailsModal(contractor)" title="Voir les détails">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-primary" (click)="navigateToEdit(contractor.id)" title="Modifier">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" (click)="archiveContractor(contractor.id)" title="Archiver">
                    <i class="fas fa-archive"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="subcontractors.length === 0">
              <td colspan="7" class="text-center py-4">Aucun sous-traitant trouvé</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="d-flex justify-content-center mt-3">
      <nav aria-label="Page navigation example">
        <ul class="pagination">
          <li class="page-item">
            <a
              (click)="goToFirstPage()"
              class="page-link"
              href="javascript:void(0)"
              aria-label="Previous"
              [class.disabled]="page === 0"
            >
              <i class="fa-solid fa-angles-left"></i>
            </a>
          </li>
          <li class="page-item">
            <a
              (click)="goToPreviousPage()"
              class="page-link"
              href="javascript:void(0)"
              aria-label="Previous"
              [class.disabled]="page === 0"
            >
              <i class="fa-solid fa-angle-left"></i>
            </a>
          </li>
          <li
            class="page-item"
            *ngFor="let pageIndex of pages"
          >
            <a
              (click)="gotToPage(pageIndex)"
              class="page-link"
              [class.active]="page === pageIndex"
              href="javascript:void(0)"
            >{{ pageIndex + 1 }}</a>
          </li>
          <li class="page-item">
            <a
              (click)="goToNextPage()"
              class="page-link"
              href="javascript:void(0)"
              aria-label="Next"
              [class.disabled]="isLastPage"
            >
              <i class="fa-solid fa-chevron-right"></i>
            </a>
          </li>
          <li class="page-item">
            <a
              (click)="goToLastPage()"
              class="page-link"
              href="javascript:void(0)"
              aria-label="Next"
              [class.disabled]="isLastPage"
            >
              <i class="fa-solid fa-angles-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Details Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="detailsModalLabel">Détails du Sous-traitant</h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeDetailsModal()" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedContractor">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Responsable:</strong> {{selectedContractor.responsible}}</p>
            <p><strong>Entreprise:</strong> {{selectedContractor.company}}</p>
            <p><strong>Expertise:</strong> {{selectedContractor.expertise}}</p>
            <p><strong>Location:</strong> {{selectedContractor.location}}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Téléphone:</strong> {{selectedContractor.phone}}</p>
            <p><strong>Email:</strong> {{selectedContractor.email}}</p>
            <p><strong>Statut:</strong> 
              <span class="badge" [ngClass]="{'bg-success': selectedContractor.status === 'active', 'bg-danger': selectedContractor.status === 'inactive'}">
                {{selectedContractor.status === 'active' ? 'Actif' : 'Inactif'}}
              </span>
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDetailsModal()">Fermer</button>
        <button type="button" class="btn btn-primary" (click)="navigateToEdit(selectedContractor!.id)">Modifier</button>
      </div>
    </div>
  </div>
</div>